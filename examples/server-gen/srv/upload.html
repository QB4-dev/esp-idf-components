<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<link rel="stylesheet" type="text/css" href="css/siimple.min.css">
		<title>Upload</title>
	</head>
	<body>
		<div class="siimple-navbar siimple-navbar--dark siimple-navbar--fluid">
			<a class="siimple-navbar-item"  href="wifi.html">WiFi</a>
			<a class="siimple-navbar-item"  href="upload.html">UPLOAD</a>
		</div>

		<div class="siimple-content siimple-content--large">

			<div class="siimple-grid">

				<div class="siimple-grid-row">
					<div class="siimple-grid-col siimple-grid-col--12">
						<h4>Firmware update:</h4>

						<form method="post" action="/upgrade" id="fotaForm" enctype="multipart/form-data">
								<input type="file" name="firmware">
								<div class="siimple-btn siimple-btn--dark" onclick="fw_upload();">UPGRADE</div>
						</form>

						<div class="siimple-spinner siimple-spinner--error" id="upgradeSpinner" style="display: none;">
						</div>

					</div>

				</div>
			</div>

		</div>

		<script>
		var upgradeSpinner = document.getElementById("upgradeSpinner");
		var fotaForm = document.getElementById("fotaForm");

		function fw_upload() {
			var data =  new FormData(fotaForm);
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if(this.readyState == 4){
					fotaForm.style.display = "";
					upgradeSpinner.style.display = "none";
				}
			};
			xhttp.open("POST","/upgrade", true);
			xhttp.send(data);

			fotaForm.style.display = "none";
			upgradeSpinner.style.display = "";
		}
		</script>

	</body>
</html>
